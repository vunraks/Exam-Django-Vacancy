{% extends 'base.html' %}
{% load static %}

{% block title %}–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <h1>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
        <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–µ–π —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é –∏ –≤–∞–∫–∞–Ω—Å–∏—è–º–∏</p>
    </div>

    <div class="profile-content">
        <div class="profile-sidebar">
            <div class="user-card">
                <div class="user-avatar">
                    {% if profile.avatar %}
                        <img class="avatar-image" src="{{ profile.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä">
                    {% else %}
                    <div class="avatar-circle">
                        {{ user.username|first|upper }}
                    </div>
                    {% endif %}
                    <h3>{{ user.username }}</h3>
                    <p class="user-email">{{ user.email|default:"Email –Ω–µ —É–∫–∞–∑–∞–Ω" }}</p>
                </div>

                <div class="user-info">
                    <div class="info-item">
                        <span class="label">–ò–º—è:</span>
                        <span class="value">{{ user.first_name|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–§–∞–º–∏–ª–∏—è:</span>
                        <span class="value">{{ user.last_name|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</span>
                        <span class="value">{{ user.date_joined|date:"d.m.Y" }}</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:</span>
                        <span class="value">{{ user.last_login|date:"d.m.Y H:i"|default:"–ù–∏–∫–æ–≥–¥–∞" }}</span>
                    </div>
                </div>
            </div>

            <div class="stats-card">
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">{{ stats.total_vacancies }}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –≤–∞–∫–∞–Ω—Å–∏–π</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" style="color: #28a745;">{{ stats.published_vacancies }}</div>
                        <div class="stat-label">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" style="color: #ffc107;">{{ stats.moderation_vacancies }}</div>
                        <div class="stat-label">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" style="color: #dc3545;">{{ stats.rejected_vacancies }}</div>
                        <div class="stat-label">–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</div>
                    </div>
                </div>

                {% if stats.total_vacancies > 0 %}
                <div class="stats-summary" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #dee2e6;">
                    <p style="font-size: 0.9rem; color: #6c757d;">
                        üìà <strong>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</strong>
                        {% if stats.total_vacancies > 0 %}
                            {{ stats.published_vacancies|floatformat:0 }} –∏–∑ {{ stats.total_vacancies }} ({{ stats.published_vacancies|floatformat:0 }}%)
                        {% else %}
                            0%
                        {% endif %}
                        –≤–∞–∫–∞–Ω—Å–∏–π –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
                    </p>
                </div>
                {% endif %}
            </div>

        </div>

        <div class="profile-main">
            <div class="edit-profile-card">
                <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h3>
                <form method="post" class="profile-form" enctype="multipart/form-data">
                    {% csrf_token %}

                    <div class="form-row">
                        <div class="form-group">
                            <label for="avatar">–ê–≤–∞—Ç–∞—Ä:</label>
                            <input type="file" id="avatar" name="avatar" class="form-control" accept="image/*">
                            <small class="form-text">PNG/JPG, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 200√ó200</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                            <input type="text" id="username" name="username"
                                   value="{{ user.username }}" class="form-control" required>
                            <small class="form-text">–ò–∑–º–µ–Ω–∏—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–º—è —Å–≤–æ–±–æ–¥–Ω–æ</small>
                        </div>
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" id="email" name="email"
                                   value="{{ user.email|default:'' }}" class="form-control">
                            <small class="form-text">–î–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="first_name">–ò–º—è:</label>
                            <input type="text" id="first_name" name="first_name"
                                   value="{{ user.first_name|default:'' }}" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="last_name">–§–∞–º–∏–ª–∏—è:</label>
                            <input type="text" id="last_name" name="last_name"
                                   value="{{ user.last_name|default:'' }}" class="form-control">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-save">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                        </a>
                    </div>
                </form>
            </div>

            <div class="my-vacancies">
                <div class="section-header">
                    <h3>üìã –ú–æ–∏ –≤–∞–∫–∞–Ω—Å–∏–∏ ({{ stats.total_vacancies }})</h3>
                    <div class="section-header-actions">
                        <a href="{% url 'vacancy_create' %}" class="btn-create-vacancy">‚ûï –°–æ–∑–¥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</a>
                    <div class="vacancy-filters">
                        <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
                        <button class="filter-btn" data-filter="published">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ</button>
                        <button class="filter-btn" data-filter="moderation">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</button>
                        <button class="filter-btn" data-filter="rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ</button>
                        </div>
                    </div>
                </div>

                {% if user_vacancies %}
                    <div class="vacancies-list">
                        {% for vacancy in user_vacancies %}
                            <div class="vacancy-item" data-status="{{ vacancy.status }}">
                                <div class="vacancy-info">
                                    <h4>
                                        <a href="{% url 'vacancy_detail' vacancy.pk %}">{{ vacancy.title }}</a>
                                        <span class="status-badge status-{{ vacancy.status }}">
                                            {% if vacancy.status == 'published' %}
                                                <span class="badge-icon">‚úÖ</span> –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
                                            {% elif vacancy.status == 'moderation' %}
                                                <span class="badge-icon">‚è≥</span> –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
                                            {% else %}
                                                <span class="badge-icon">‚ùå</span> –û—Ç–∫–ª–æ–Ω–µ–Ω–æ
                                            {% endif %}
                                        </span>
                                    </h4>
                                    <p class="vacancy-meta">
                                        <span>üè¢ {{ vacancy.company }}</span>
                                        <span>üí∞ {{ vacancy.salary|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞" }} {% if vacancy.salary %}‚Ç∏{% endif %}</span>
                                        <span>üìÖ {{ vacancy.created_at|date:"d.m.Y H:i" }}</span>
                                        {% if vacancy.experience %}
                                            <span>‚è≥ {{ vacancy.experience }}</span>
                                        {% endif %}
                                    </p>
                                    <p class="vacancy-description">
                                        {{ vacancy.description|truncatechars:150 }}
                                    </p>
                                </div>
                                <div class="vacancy-actions">
                                    <a href="{% url 'vacancy_detail' vacancy.pk %}" class="btn-view" title="–ü—Ä–æ—Å–º–æ—Ç—Ä">
                                        –ü—Ä–æ—Å–º–æ—Ç—Ä
                                    </a>
                                    <a href="{% url 'vacancy_update' vacancy.pk %}" class="btn-edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </a>
                                    <a href="{% url 'vacancy_delete' vacancy.pk %}" class="btn-delete" title="–£–¥–∞–ª–∏—Ç—å">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    <div class="pagination">
                        <p style="text-align: center; color: #6c757d; font-size: 0.9rem;">
                            –ü–æ–∫–∞–∑–∞–Ω–æ {{ user_vacancies|length }} –∏–∑ {{ stats.total_vacancies }} –≤–∞–∫–∞–Ω—Å–∏–π
                        </p>
                    </div>
                {% else %}
                    <div class="no-vacancies">
                        <div class="empty-state">
                            <div class="empty-icon">üì≠</div>
                            <h4>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–π</h4>
                            <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –≤–∞–∫–∞–Ω—Å–∏—é –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</p>
                            <a href="{% url 'vacancy_create' %}" class="btn-create-large">
                                ‚ûï –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –≤–∞–∫–∞–Ω—Å–∏—é
                            </a>
                            <p style="margin-top: 15px; font-size: 0.9rem;">
                                <a href="{% url 'vacancy_list' %}">üëâ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏</a>
                            </p>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∞–∫–∞–Ω—Å–∏–π –ø–æ —Å—Ç–∞—Ç—É—Å—É
        const filterButtons = document.querySelectorAll('.filter-btn');
        const vacancyItems = document.querySelectorAll('.vacancy-item');

        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                filterButtons.forEach(btn => btn.classList.remove('active'));
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –∫–Ω–æ–ø–∫–µ
                this.classList.add('active');

                const filter = this.dataset.filter;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≤–∞–∫–∞–Ω—Å–∏–∏
                vacancyItems.forEach(item => {
                    if (filter === 'all' || item.dataset.status === filter) {
                        item.style.display = 'flex';
                        setTimeout(() => {
                            item.style.opacity = '1';
                            item.style.transform = 'translateX(0)';
                        }, 10);
                    } else {
                        item.style.opacity = '0';
                        item.style.transform = 'translateX(-20px)';
                        setTimeout(() => {
                            item.style.display = 'none';
                        }, 300);
                    }
                });
            });
        });

        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π –≤ —Ñ–æ—Ä–º–µ
        const form = document.querySelector('.profile-form');
        if (form) {
            const inputs = form.querySelectorAll('input');

            inputs.forEach(input => {
                const originalValue = input.value;

                input.addEventListener('input', function() {
                    if (this.value !== originalValue) {
                        this.style.borderColor = '#ffc107';
                        this.style.boxShadow = '0 0 0 3px rgba(255, 193, 7, 0.1)';
                    } else {
                        this.style.borderColor = '#e1e5eb';
                        this.style.boxShadow = 'none';
                    }
                });
            });

            form.addEventListener('submit', function(e) {
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º...';
                submitBtn.disabled = true;

                setTimeout(() => {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }, 2000);
            });
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø—É—Å—Ç–æ–º —Å–ø–∏—Å–∫–µ –≤–∞–∫–∞–Ω—Å–∏–π
        const noVacancies = document.querySelector('.no-vacancies');
        if (noVacancies) {
            setTimeout(() => {
                noVacancies.style.opacity = '1';
                noVacancies.style.transform = 'translateY(0)';
            }, 500);
        }
    });
</script>
{% endblock %}