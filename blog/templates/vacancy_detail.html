{% extends 'base.html' %}
{% load static %}

{% block title %}{{ vacancy.title }} - –ü–æ–∏—Å–∫ –≤–∞–∫–∞–Ω—Å–∏–π{% endblock %}

{% block content %}
<div class="vacancy-detail-container">
    <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
    <div class="breadcrumbs">
        <a href="{% url 'home_page' %}">üè† –ì–ª–∞–≤–Ω–∞—è</a>
        <span class="separator">‚Ä∫</span>
        <a href="{% url 'vacancy_list' %}">üìã –í—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏</a>
        <span class="separator">‚Ä∫</span>
        <span class="current">–î–µ—Ç–∞–ª–∏ –≤–∞–∫–∞–Ω—Å–∏–∏</span>
    </div>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤–∞–∫–∞–Ω—Å–∏–∏ -->
    <div class="vacancy-header">
        <div class="vacancy-title-section">
            <h1>{{ vacancy.title }}</h1>
            <div class="vacancy-meta">
                <div class="company-info">
                    <span class="company-icon">üè¢</span>
                    <span class="company-name">{{ vacancy.company }}</span>

                    {% if vacancy.location %}
                        <span class="location-info">
                            <span class="location-icon">üìç</span>
                            {{ vacancy.location }}
                        </span>
                    {% endif %}

                    <span class="date-info">
                        <span class="date-icon">üìÖ</span>
                        –î–æ–±–∞–≤–ª–µ–Ω–æ: {{ vacancy.created_at|date:"d.m.Y H:i" }}
                        {% if vacancy.updated_at != vacancy.created_at %}
                            (–æ–±–Ω–æ–≤–ª–µ–Ω–æ: {{ vacancy.updated_at|date:"d.m.Y H:i" }})
                        {% endif %}
                    </span>
                </div>

                <div class="vacancy-status">
                    {% if vacancy.status == 'published' %}
                        <span class="status-badge published">‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</span>
                    {% elif vacancy.status == 'moderation' %}
                        <span class="status-badge moderation">‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</span>
                    {% else %}
                        <span class="status-badge rejected">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ</span>
                    {% endif %}

                    {% if vacancy.author %}
                        <span class="author-info">
                            <span class="author-icon">üë§</span>
                            –ê–≤—Ç–æ—Ä: {{ vacancy.author.username }}
                        </span>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- –ë–ª–æ–∫ —Å –∑–∞—Ä–ø–ª–∞—Ç–æ–π -->
        <div class="salary-section">
            {% if vacancy.salary %}
                <div class="salary-amount">üí∞ {{ vacancy.salary }} ‚Ç∏</div>
                <div class="salary-label">–ó–∞—Ä–ø–ª–∞—Ç–∞</div>
            {% else %}
                <div class="salary-amount">üí∞ –ü–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏</div>
                <div class="salary-label">–ó–∞—Ä–ø–ª–∞—Ç–∞</div>
            {% endif %}
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="vacancy-content">
        <div class="main-info">
            <!-- –û–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏ -->
            <div class="description-section">
                <h2>üìù –û–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏</h2>
                <div class="description-content">
                    {{ vacancy.description|linebreaks }}
                </div>
            </div>

            <!-- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ —É—Å–ª–æ–≤–∏—è -->
            <div class="requirements-section">
                <h2>üéØ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ —É—Å–ª–æ–≤–∏—è</h2>
                <div class="requirements-grid">
                    {% if vacancy.experience %}
                    <div class="requirement-item">
                        <div class="requirement-icon">‚è≥</div>
                        <div class="requirement-content">
                            <h4>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</h4>
                            <p>{{ vacancy.experience }}</p>
                        </div>
                    </div>
                    {% endif %}

                    <div class="requirement-item">
                        <div class="requirement-icon">üíº</div>
                        <div class="requirement-content">
                            <h4>–¢–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏</h4>
                            <p>–ü–æ–ª–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å</p>
                        </div>
                    </div>

                    <div class="requirement-item">
                        <div class="requirement-icon">üè¢</div>
                        <div class="requirement-content">
                            <h4>–ö–æ–º–ø–∞–Ω–∏—è</h4>
                            <p>{{ vacancy.company }}</p>
                        </div>
                    </div>

                    {% if vacancy.location %}
                    <div class="requirement-item">
                        <div class="requirement-icon">üìç</div>
                        <div class="requirement-content">
                            <h4>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h4>
                            <p>{{ vacancy.location }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="action-section">
                <h2>‚ö° –î–µ–π—Å—Ç–≤–∏—è</h2>
                <div class="action-buttons">
                    {% if user.is_authenticated %}
                        {% if vacancy.author == user %}
                            <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∞ –≤–∞–∫–∞–Ω—Å–∏–∏ -->
                            <a href="{% url 'vacancy_update' vacancy.pk %}" class="btn-edit-large">
                                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é
                            </a>
                            <a href="{% url 'vacancy_delete' vacancy.pk %}" class="btn-delete-large">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é
                            </a>
                        {% else %}
                            <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                            <button class="btn-apply-large" onclick="applyForVacancy()">
                                üì® –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é
                            </button>
                            <button class="btn-save-large" onclick="saveVacancy()">
                                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                            </button>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'login' %}" class="btn-apply-large">
                            üîë –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è
                        </a>
                    {% endif %}

                    <a href="{% url 'vacancy_list' %}" class="btn-back-large">
                        ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –≤–∞–∫–∞–Ω—Å–∏–π
                    </a>
                </div>
            </div>
        </div>

        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar">
            <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="quick-actions-card">
                <h3>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                <div class="quick-buttons">
                    <a href="{% url 'home_page' %}" class="quick-btn">
                        üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
                    </a>
                    <a href="{% url 'vacancy_list' %}" class="quick-btn">
                        üìã –í—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏
                    </a>

                    {% if user.is_authenticated and vacancy.author != user %}
                        <button class="quick-btn" onclick="shareVacancy()">
                            üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                        </button>
                        <button class="quick-btn" onclick="printVacancy()">
                            üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å
                        </button>
                    {% endif %}
                </div>
            </div>

            <!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="contact-card">
                <h3>üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <div class="contact-info">
                    <p><strong>–ö–æ–º–ø–∞–Ω–∏—è:</strong> {{ vacancy.company }}</p>

                    {% if vacancy.location %}
                        <p><strong>–ê–¥—Ä–µ—Å:</strong> {{ vacancy.location }}</p>
                    {% endif %}

                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong>
                        {% if vacancy.status == 'published' %}
                            <span class="status-text published">‚úÖ –ê–∫—Ç–∏–≤–Ω–∞—è</span>
                        {% elif vacancy.status == 'moderation' %}
                            <span class="status-text moderation">‚è≥ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</span>
                        {% else %}
                            <span class="status-text rejected">‚ùå –ó–∞–∫—Ä—ã—Ç–∞—è</span>
                        {% endif %}
                    </p>

                    <p><strong>–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</strong> {{ vacancy.created_at|date:"d.m.Y" }}</p>

                    {% if vacancy.author %}
                        <p><strong>–†–∞–∑–º–µ—Å—Ç–∏–ª:</strong> {{ vacancy.author.username }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ -->
            <div class="stats-card">
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-content">
                    <div class="stat-item">
                        <div class="stat-value">üî•</div>
                        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω–∞—è –≤–∞–∫–∞–Ω—Å–∏—è</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">üëÅÔ∏è</div>
                        <div class="stat-label">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã: 0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">üì®</div>
                        <div class="stat-label">–û—Ç–∫–ª–∏–∫–∏: 0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script>
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –≤–∞–∫–∞–Ω—Å–∏–µ–π
    function applyForVacancy() {
        if(confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ —ç—Ç—É –≤–∞–∫–∞–Ω—Å–∏—é?')) {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AJAX –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            alert('–í–∞—à –æ—Ç–∫–ª–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.');

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateStats('responses');
        }
    }

    function saveVacancy() {
        if(confirm('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç—É –≤–∞–∫–∞–Ω—Å–∏—é –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ?')) {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
            alert('–í–∞–∫–∞–Ω—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!');
            updateStats('saves');
        }
    }

    function shareVacancy() {
        const vacancyUrl = window.location.href;
        const vacancyTitle = document.querySelector('h1').textContent;

        if(navigator.share) {
            navigator.share({
                title: vacancyTitle,
                text: '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —ç—Ç—É –≤–∞–∫–∞–Ω—Å–∏—é: ' + vacancyTitle,
                url: vacancyUrl
            });
        } else {
            // –ö–æ–ø–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            navigator.clipboard.writeText(vacancyUrl).then(() => {
                alert('–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            });
        }
    }

    function printVacancy() {
        window.print();
    }

    function updateStats(type) {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —á–µ—Ä–µ–∑ AJAX
        console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞:', type);
    }

    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
    document.addEventListener('DOMContentLoaded', function() {
        const description = document.querySelector('.description-content');
        if(description) {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
            const keywords = ['—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è', '–æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏', '—É—Å–ª–æ–≤–∏—è', '–∑–∞—Ä–ø–ª–∞—Ç–∞', '–æ–ø—ã—Ç'];
            let html = description.innerHTML;

            keywords.forEach(keyword => {
                const regex = new RegExp(`(${keyword})`, 'gi');
                html = html.replace(regex, '<mark>$1</mark>');
            });

            description.innerHTML = html;
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if(entry.isIntersecting) {
                    entry.target.classList.add('animated');
                }
            });
        }, observerOptions);

        // –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ –≤—Å–µ–º–∏ —Å–µ–∫—Ü–∏—è–º–∏
        document.querySelectorAll('.description-section, .requirements-section, .action-section').forEach(section => {
            observer.observe(section);
        });
    });
</script>
{% endblock %}