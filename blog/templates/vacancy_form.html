{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å—Ç–∏–ª–∏ —Ñ–æ—Ä–º—ã -->
<link rel="stylesheet" href="{% static 'css/vacancy_form.css' %}">
{% endblock %}

{% block content %}
<div class="form-container">
    <form method="post" class="vacancy-form" id="vacancyForm">
        <h2>{% if form.instance.pk %}‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é{% else %}‚ûï –°–æ–∑–¥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é{% endif %}</h2>

        {% if messages %}
            {% for message in messages %}
                <div class="success-message">{{ message }}</div>
            {% endfor %}
        {% endif %}

        {% csrf_token %}

        <div class="form-field">
            <label for="{{ form.title.id_for_label }}">–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏:</label>
            {{ form.title }}
            {% if form.title.errors %}
                <div class="error">{{ form.title.errors.0 }}</div>
            {% endif %}
            <span class="field-hint">–£–∫–∞–∂–∏—Ç–µ —Ç–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏</span>
            <div class="char-counter" id="title-counter">0/100</div>
        </div>

        <div class="form-field">
            <label for="{{ form.description.id_for_label }}">–û–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏:</label>
            {{ form.description }}
            {% if form.description.errors %}
                <div class="error">{{ form.description.errors.0 }}</div>
            {% endif %}
            <span class="field-hint">–û–ø–∏—à–∏—Ç–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ —É—Å–ª–æ–≤–∏—è —Ä–∞–±–æ—Ç—ã</span>
            <div class="char-counter" id="description-counter">0/2000</div>
        </div>

        <div class="form-field">
            <label for="{{ form.company.id_for_label }}">–ö–æ–º–ø–∞–Ω–∏—è:</label>
            {{ form.company }}
            {% if form.company.errors %}
                <div class="error">{{ form.company.errors.0 }}</div>
            {% endif %}
            <span class="field-hint">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è</span>
        </div>

        <div class="form-field">
            <label for="{{ form.location.id_for_label }}">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</label>
            {{ form.location }}
            {% if form.location.errors %}
                <div class="error">{{ form.location.errors.0 }}</div>
            {% endif %}
            <span class="field-hint">–ì–æ—Ä–æ–¥ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞</span>
        </div>

        <div class="form-field">
            <label for="{{ form.salary.id_for_label }}">–ó–∞—Ä–ø–ª–∞—Ç–∞ (–≤ —Ç–µ–Ω–≥–µ):</label>
            {{ form.salary }}
            {% if form.salary.errors %}
                <div class="error">{{ form.salary.errors.0 }}</div>
            {% endif %}
            <span class="field-hint">–£–∫–∞–∂–∏—Ç–µ —Å—É–º–º—É –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω</span>
        </div>

        <div class="form-field">
            <label for="{{ form.experience.id_for_label }}">–¢—Ä–µ–±—É–µ–º—ã–π –æ–ø—ã—Ç (–ª–µ—Ç):</label>
            {{ form.experience }}
            {% if form.experience.errors %}
                <div class="error">{{ form.experience.errors.0 }}</div>
            {% endif %}
            <span class="field-hint">0 - –¥–ª—è —Å—Ç–∞–∂–µ—Ä–æ–≤, –±–µ–∑ –æ–ø—ã—Ç–∞</span>
        </div>

        <button type="submit" id="submitBtn">
            {% if form.instance.pk %}üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è{% else %}üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é{% endif %}
        </button>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('vacancyForm');
    const titleInput = document.getElementById('{{ form.title.id_for_label }}');
    const descriptionInput = document.getElementById('{{ form.description.id_for_label }}');
    const titleCounter = document.getElementById('title-counter');
    const descriptionCounter = document.getElementById('description-counter');
    const submitBtn = document.getElementById('submitBtn');

    // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
    if (titleInput && titleCounter) {
        updateCounter(titleInput, titleCounter, 100);
        titleInput.addEventListener('input', function() {
            updateCounter(this, titleCounter, 100);
        });
    }

    // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è
    if (descriptionInput && descriptionCounter) {
        updateCounter(descriptionInput, descriptionCounter, 2000);
        descriptionInput.addEventListener('input', function() {
            updateCounter(this, descriptionCounter, 2000);
        });
    }

    function updateCounter(input, counter, maxLength) {
        const length = input.value.length;
        counter.textContent = `${length}/${maxLength}`;

        // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
        counter.classList.remove('warning', 'error');

        if (length > maxLength * 0.9) {
            counter.classList.add('error');
        } else if (length > maxLength * 0.8) {
            counter.classList.add('warning');
        }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    if (form) {
        form.addEventListener('submit', function(e) {
            let hasErrors = false;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
            const requiredFields = form.querySelectorAll('input[required], textarea[required]');
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('error-input');
                    hasErrors = true;
                } else {
                    field.classList.remove('error-input');
                }
            });

            if (hasErrors) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return false;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';

            return true;
        });
    }

    // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ
    const inputs = form.querySelectorAll('input, textarea, select');
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            this.classList.remove('error-input');
        });
    });
});
</script>
{% endblock %}