{% extends 'base.html' %}
{% load static %}

{% block title %}–í—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏ - –ü–æ–∏—Å–∫ –≤–∞–∫–∞–Ω—Å–∏–π{% endblock %}

{% block content %}
<div class="vacancies-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="page-header">
        <h1>üìã –í—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏</h1>
        <p>–ù–∞–π–¥–∏—Ç–µ —Ä–∞–±–æ—Ç—É —Å–≤–æ–µ–π –º–µ—á—Ç—ã —Å—Ä–µ–¥–∏ —Ç—ã—Å—è—á –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</p>
    </div>
    
    <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
    <div class="vacancy-controls">
        <div class="search-box">
            <form method="GET" action="{% url 'vacancy_list' %}" class="search-form">
                <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∫–æ–º–ø–∞–Ω–∏–∏..." 
                       value="{{ request.GET.search }}" class="search-input">
                <button type="submit" class="search-btn">üîç –ù–∞–π—Ç–∏</button>
                {% if request.GET.search %}
                    <a href="{% url 'vacancy_list' %}" class="clear-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</a>
                {% endif %}
            </form>
        </div>
        
        <div class="action-buttons">
            {% if user.is_authenticated %}
                <a href="{% url 'vacancy_create' %}" class="btn-add-vacancy">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é
                </a>
            {% else %}
                <a href="{% url 'login' %}" class="btn-add-vacancy" title="–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é">
                    üîí –î–æ–±–∞–≤–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é
                </a>
            {% endif %}
        </div>
    </div>
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="vacancy-stats">
        <div class="stat-item">
            <span class="stat-number">{{ vacancies.count }}</span>
            <span class="stat-label">–í—Å–µ–≥–æ –≤–∞–∫–∞–Ω—Å–∏–π</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">{{ vacancies|length }}</span>
            <span class="stat-label">–ü–æ–∫–∞–∑–∞–Ω–æ</span>
        </div>
    </div>
    
    <!-- –°–ø–∏—Å–æ–∫ –≤–∞–∫–∞–Ω—Å–∏–π -->
    <div class="vacancies-list">
        {% if vacancies %}
            {% for vacancy in vacancies %}
                <div class="vacancy-card">
                    <div class="vacancy-header">
                        <div class="vacancy-title-section">
                            <h3>
                                <a href="{% url 'vacancy_detail' vacancy.pk %}" class="vacancy-title">
                                    {{ vacancy.title }}
                                </a>
                                {% if vacancy.status == 'published' %}
                                    <span class="status-badge published">‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</span>
                                {% elif vacancy.status == 'moderation' %}
                                    <span class="status-badge moderation">‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</span>
                                {% else %}
                                    <span class="status-badge rejected">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ</span>
                                {% endif %}
                            </h3>
                            <div class="vacancy-company">
                                <span class="company-icon">üè¢</span>
                                {{ vacancy.company }}
                                {% if vacancy.location %}
                                    <span class="location">
                                        <span class="location-icon">üìç</span>
                                        {{ vacancy.location }}
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="vacancy-salary">
                            {% if vacancy.salary %}
                                <span class="salary-amount">üí∞ {{ vacancy.salary }} ‚Ç∏</span>
                            {% else %}
                                <span class="salary-amount">üí∞ –ü–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="vacancy-body">
                        <div class="vacancy-description">
                            <p>{{ vacancy.description|truncatechars:200 }}</p>
                        </div>
                        
                        <div class="vacancy-details">
                            {% if vacancy.experience %}
                                <span class="detail-item">
                                    <span class="detail-icon">‚è≥</span>
                                    –û–ø—ã—Ç: {{ vacancy.experience }}
                                </span>
                            {% endif %}
                            
                            <span class="detail-item">
                                <span class="detail-icon">üìÖ</span>
                                –î–æ–±–∞–≤–ª–µ–Ω–æ: {{ vacancy.created_at|date:"d.m.Y" }}
                            </span>
                            
                            {% if vacancy.author %}
                                <span class="detail-item">
                                    <span class="detail-icon">üë§</span>
                                    –ê–≤—Ç–æ—Ä: {{ vacancy.author.username }}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="vacancy-footer">
                        <div class="vacancy-actions">
                            <a href="{% url 'vacancy_detail' vacancy.pk %}" class="btn-view">
                                üëÅÔ∏è –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </a>
                            
                            {% if user.is_authenticated and vacancy.author == user %}
                                <a href="{% url 'vacancy_update' vacancy.pk %}" class="btn-edit">
                                    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </a>
                                <a href="{% url 'vacancy_delete' vacancy.pk %}" class="btn-delete">
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </a>
                            {% endif %}
                            
                            {% if user.is_authenticated and user != vacancy.author %}
                                <button class="btn-apply" onclick="applyForVacancy({{ vacancy.pk }})">
                                    üì® –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –≤–∞–∫–∞–Ω—Å–∏–π –Ω–µ—Ç -->
            <div class="no-vacancies">
                <div class="empty-state">
                    <div class="empty-icon">üì≠</div>
                    <h3>–í–∞–∫–∞–Ω—Å–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                    <p>
                        {% if request.GET.search %}
                            –ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ request.GET.search }}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.
                        {% else %}
                            –ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –¥–æ–±–∞–≤–∏—Ç –≤–∞–∫–∞–Ω—Å–∏—é!
                        {% endif %}
                    </p>
                    <div class="empty-actions">
                        {% if user.is_authenticated %}
                            <a href="{% url 'vacancy_create' %}" class="btn-add-vacancy-large">
                                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –≤–∞–∫–∞–Ω—Å–∏—é
                            </a>
                        {% else %}
                            <a href="{% url 'register' %}" class="btn-add-vacancy-large">
                                üìù –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                            </a>
                            <a href="{% url 'login' %}" class="btn-login">
                                üîë –í–æ–π—Ç–∏
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
    
    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ) -->
    {% if vacancies.has_other_pages %}
    <div class="pagination">
        <span class="step-links">
            {% if vacancies.has_previous %}
                <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">¬´ –ü–µ—Ä–≤–∞—è</a>
                <a href="?page={{ vacancies.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">‚Äπ –ù–∞–∑–∞–¥</a>
            {% endif %}
            
            <span class="current">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ vacancies.number }} –∏–∑ {{ vacancies.paginator.num_pages }}
            </span>
            
            {% if vacancies.has_next %}
                <a href="?page={{ vacancies.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">–í–ø–µ—Ä–µ–¥ ‚Ä∫</a>
                <a href="?page={{ vacancies.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</a>
            {% endif %}
        </span>
    </div>
    {% endif %}
</div>

<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é
    function applyForVacancy(vacancyId) {
        if(confirm('–í—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ —ç—Ç—É –≤–∞–∫–∞–Ω—Å–∏—é?')) {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AJAX –∑–∞–ø—Ä–æ—Å
            alert('–í–∞—à –æ—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏.');
        }
    }
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
        const searchInput = document.querySelector('.search-input');
        if (searchInput && searchInput.value) {
            searchInput.style.borderColor = '#28a745';
            searchInput.style.boxShadow = '0 0 0 3px rgba(40, 167, 69, 0.1)';
        }
    });
</script>
{% endblock %}